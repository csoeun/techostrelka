<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Профиль</title>
  <link rel="stylesheet" href="/static/css/styles.css" />
</head>

<body>
  <br />
  <div class="topnav">
    <img src="/static/img/Vector.png" class="logo" alt="" />
    <a href="/profile" class="active">Профиль</a>
    <a href="/login">Войти</a>
    <a href="/list">Перечень олимпиад</a>
    <a href="/">Главная</a>
  </div>

  <div class="containerr">
    <h3 id="usernamePlaceholder">username</h3>

    <input type="text" placeholder="Codeforces" id="codeforces">
    <input type="text" placeholder="ACMP" id="acmp">
    <input type="text" placeholder="Яндекс.Контест" id="yandex">

    <button onclick="updateProfile()">Привязать</button>

    <h1>Статистика</h1>
  </div>

  <script>
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(";").shift();
    }

    function updateProfile() {
      const codeforces = document.getElementById("codeforces").value;
      const acmp = document.getElementById("acmp").value;
      const yandex = document.getElementById("yandex").value;
      const login = getCookie("login");

      fetch("/api/user/edit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ codeforces, acmp, yandex, login }),
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((data) => {
          console.log(data);
        })
        .catch((error) => {
          console.error("There was a problem updating the profile:", error);
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
      const login = getCookie("login");
      if (login) {
        document.getElementById("usernamePlaceholder").innerText = login;
      }

      // Вызываем функцию data при загрузке страницы
      fetchData();
    });

    function fetchData() {
      fetch("/api/user/")
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((data) => {
          document.getElementById("codeforces").value = data.codeforces || "";
          document.getElementById("acmp").value = data.acmp || "";
          document.getElementById("yandex").value = data.yandex || "";
        })
        .catch((error) => {
          console.error("There was a problem fetching user data:", error);
          alert("Failed to fetch user data. Please try again later.");
        });
    }

  </script>
</body>

</html>